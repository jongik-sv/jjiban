# TSK-05-04: 통합 테스트 - 기본설계

**Task ID**: TSK-05-04
**Category**: development
**Status**: [bd] → [dd]
**Date**: 2025-12-17
**Author**: Quality Engineer

---

## 1. 테스트 목적

### 1.1 핵심 목표

워크플로우 유연화(WP-05) 전체 구현의 통합 검증을 통해 시스템 안정성을 확보합니다.

| 목표 | 설명 | 성공 기준 |
|------|------|----------|
| 기능 검증 | 3가지 카테고리별 워크플로우 정상 동작 | 모든 상태 전이 성공 |
| 호환성 검증 | 레거시 상태 코드 정상 처리 | `[ts]` → `[vf]` 자동 매핑 |
| 안정성 검증 | 설정 파일 없어도 정상 동작 | 기본값 폴백 성공 |

### 1.2 테스트 범위

**포함 (In-Scope)**:
- 카테고리별 워크플로우 전체 흐름 (development, defect, infrastructure)
- 상태 코드 정규화 및 매핑 (레거시 호환)
- 설정 파일 로드 실패 시 폴백 메커니즘
- CLI 명령어 → 상태 전이 검증

**제외 (Out-of-Scope)**:
- UI 레벨 테스트 (별도 E2E 테스트)
- 성능 테스트 (별도 Task)
- 보안 테스트 (별도 Task)

---

## 2. 의존성 확인

### 2.1 선행 Task 완료 확인

| Task ID | 제목 | 완료 여부 | 검증 항목 |
|---------|------|----------|----------|
| TSK-05-01 | CLI 설정 로더 생성 | 확인 필요 | `cli/config/settingsLoader.js` 존재 |
| TSK-05-02 | workflowSteps 리팩토링 | 확인 필요 | `getWorkflowSteps()` 함수 존재 |
| TSK-05-03 | 상태 코드 통일 | 확인 필요 | `WbsReader.js` 정규화 로직 |

### 2.2 테스트 환경 요구사항

| 항목 | 요구사항 | 확인 방법 |
|------|----------|----------|
| Node.js | 20.x | `node --version` |
| CLI 설치 | `npx jjiban` 실행 가능 | `npx jjiban --version` |
| 테스트 프로젝트 | `.jjiban/projects/test-wf` 준비 | 디렉토리 존재 확인 |

---

## 3. 테스트 시나리오 개요

### 3.1 시나리오 구조

```
테스트 Suite
├── 1. 카테고리별 워크플로우 테스트
│   ├── 1.1 Development 워크플로우
│   ├── 1.2 Defect 워크플로우
│   └── 1.3 Infrastructure 워크플로우
├── 2. 호환성 테스트
│   ├── 2.1 레거시 상태 코드 정규화
│   ├── 2.2 기존 WBS 파일 파싱
│   └── 2.3 상태 전이 매핑
└── 3. 폴백 테스트
    ├── 3.1 workflows.json 없음
    ├── 3.2 workflows.json 형식 오류
    └── 3.3 부분 설정 누락
```

### 3.2 테스트 데이터

**테스트 프로젝트 ID**: `test-wf`
**테스트 Task ID 명명 규칙**: `TST-{category}-{sequence}`

예시:
- `TST-DEV-01`: Development 카테고리 테스트
- `TST-DFT-01`: Defect 카테고리 테스트
- `TST-INF-01`: Infrastructure 카테고리 테스트

---

## 4. 테스트 접근 방법

### 4.1 테스트 레벨

| 레벨 | 방법 | 도구 |
|------|------|------|
| 단위 테스트 | 함수별 로직 검증 | Jest (필요 시) |
| 통합 테스트 | CLI 명령어 실행 → WBS 파일 변경 검증 | Bash 스크립트 |
| 시나리오 테스트 | 실제 워크플로우 흐름 검증 | 수동 실행 + 스크립트 |

### 4.2 검증 방법

**상태 전이 검증**:
```bash
# 1. 초기 상태 확인
grep "TST-DEV-01" .jjiban/projects/test-wf/wbs.md

# 2. 명령어 실행
npx jjiban workflow start test-wf TST-DEV-01

# 3. 변경 상태 확인
grep "TST-DEV-01" .jjiban/projects/test-wf/wbs.md

# 4. 예상 상태와 비교
# Expected: status: [bd]
```

**설정 파일 폴백 검증**:
```bash
# 1. 설정 파일 임시 이동
mv .jjiban/settings/workflows.json .jjiban/settings/workflows.json.bak

# 2. CLI 실행
npx jjiban workflow start test-wf TST-DEV-01

# 3. 에러 없이 실행되는지 확인
# Expected: 기본값 사용, 정상 동작

# 4. 복구
mv .jjiban/settings/workflows.json.bak .jjiban/settings/workflows.json
```

---

## 5. 성공 기준

### 5.1 필수 통과 조건

| 항목 | 기준 | 측정 방법 |
|------|------|----------|
| 워크플로우 완전성 | 3가지 카테고리 전체 상태 전이 성공 | 각 카테고리 종료 상태 `[xx]` 도달 |
| 호환성 | 레거시 상태 코드 100% 정규화 | `[ts]` → `[vf]`, `[ds]` → `[dd]` 자동 변환 |
| 안정성 | 설정 파일 없어도 정상 동작 | 에러 없이 기본값 폴백 |
| 데이터 무결성 | WBS 파일 형식 유지 | 마크다운 구조 파괴 없음 |

### 5.2 선택 통과 조건

| 항목 | 기준 | 중요도 |
|------|------|--------|
| 에러 메시지 명확성 | 사용자가 이해 가능한 메시지 | Medium |
| 성능 | 명령어 실행 시간 < 3초 | Low |
| 로그 품질 | 디버깅 가능한 로그 출력 | Medium |

---

## 6. 위험 요소 및 대응

### 6.1 기술적 위험

| 위험 | 확률 | 영향도 | 대응 방안 |
|------|------|--------|----------|
| 레거시 상태 코드 미처리 | 중 | 높음 | 모든 알려진 상태 코드 테스트 케이스 추가 |
| 설정 파일 형식 오류 무한 루프 | 저 | 중 | 최대 재시도 횟수 제한 검증 |
| WBS 파일 파싱 실패 | 중 | 높음 | 다양한 WBS 형식 테스트 |

### 6.2 프로세스 위험

| 위험 | 확률 | 영향도 | 대응 방안 |
|------|------|--------|----------|
| 선행 Task 미완료 | 중 | 높음 | 의존성 확인 단계 필수화 |
| 테스트 데이터 오염 | 중 | 중 | 테스트 전용 프로젝트 사용 |
| 시간 부족 | 중 | 중 | 핵심 시나리오 우선순위화 |

---

## 7. 테스트 일정 및 리소스

### 7.1 예상 일정

| 단계 | 기간 | 산출물 |
|------|------|--------|
| 상세설계 | 0.5일 | `020-detail-design.md` |
| 테스트 데이터 준비 | 0.5일 | 테스트 WBS 파일 |
| 테스트 실행 | 1일 | 테스트 결과 로그 |
| 결과 정리 및 보고 | 0.5일 | `070-integration-test.md` |
| **합계** | **2.5일** | |

### 7.2 필요 리소스

| 리소스 | 용도 | 비고 |
|--------|------|------|
| 테스트 프로젝트 디렉토리 | 독립 테스트 환경 | `.jjiban/projects/test-wf` |
| 테스트 스크립트 | 자동화 실행 | Bash 스크립트 |
| 백업 설정 파일 | 복구 및 비교 | `*.bak` 파일 |

---

## 8. 다음 단계

### 8.1 상세설계 문서 작성

`020-detail-design.md`에서 다음 내용을 구체화합니다:
- 각 테스트 케이스 상세 시나리오
- 입력 데이터 및 예상 출력
- 테스트 스크립트 구현 계획
- 검증 체크리스트

### 8.2 준비 사항

- TSK-05-01, TSK-05-02, TSK-05-03 완료 확인
- 테스트 프로젝트 생성
- 테스트 WBS 파일 템플릿 준비

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|-----------|--------|
| 1.0 | 2025-12-17 | 기본설계 작성 | Quality Engineer |
